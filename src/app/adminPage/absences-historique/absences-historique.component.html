<div class="p-6 max-w-7xl mx-auto">

    <!-- üîç Recherche -->
    <div class="relative w-full max-w-md mb-4">
        <input type="text" [(ngModel)]="searchText" placeholder="Recherche..." class="w-full pl-10 pr-4 py-2
             border border-gray-300 rounded-lg shadow-sm
             focus:outline-none focus:ring-2 focus:ring-blue-500
             transition" />
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
    </div>

    <!-- ‚¨áÔ∏è Actions -->
    <div class="flex flex-wrap gap-3 mb-6">
        <button (click)="exportExcel()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow">
            üìä Excel
        </button>
        <button (click)="exportPdf()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow">
            üìÑ PDF
        </button>
    </div>

    <!-- üü° Titre -->
    <h2 class="text-xl font-semibold mb-4 text-center text-gray-600">
        Historique des absences
    </h2>

    <!-- üìã Tableau -->
    <div class="overflow-x-auto bg-white rounded-xl shadow border border-gray-200">
        <table class="min-w-full table-auto text-sm">

            <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
                <tr>
                    <th class="px-4 py-3 text-left">Code</th>
                    <th class="px-4 py-3 text-left">Pr√©nom</th>
                    <th class="px-4 py-3 text-left">Nom</th>
                    <th class="px-4 py-3 text-left">Num√©ro</th>
                    <th class="px-4 py-3 text-left">Date</th>
                    <th class="px-4 py-3 text-left">Motif</th>
                    <th class="px-4 py-3 text-left">Justification</th>
                    <th class="px-4 py-3 text-left">Site</th>
                    <th class="px-4 py-3 text-center">Actions</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let absent of filteredAbsents" class="border-t hover:bg-gray-50 transition">
                    <td class="px-4 py-2 font-medium">{{ absent.codeSecret }}</td>
                    <td class="px-4 py-2">{{ absent.prenom }}</td>
                    <td class="px-4 py-2">{{ absent.nom }}</td>
                    <td class="px-4 py-2">{{ absent.numero }}</td>
                    <td class="px-4 py-2">{{ absent.dateAbsence }}</td>

                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded-full text-xs bg-red-100 text-red-700">
                            {{ absent.motif || '‚Äî' }}
                        </span>
                    </td>

                    <td class="px-4 py-2">
                        {{ absent.justification || '‚Äî' }}
                    </td>

                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-700">
                            {{ absent.site }}
                        </span>
                    </td>

                    <td class="px-4 py-2 text-center">
                        <button (click)="openEditModal(absent)" class="bg-blue-600 hover:bg-blue-700 text-white
                     rounded-full p-2 shadow transition-transform
                     hover:scale-110 active:scale-95" title="Modifier">
                            ‚úèÔ∏è
                        </button>
                    </td>
                </tr>

                <!-- Aucun r√©sultat -->
                <tr *ngIf="filteredAbsents.length === 0">
                    <td colspan="9" class="text-center py-6 text-gray-500">
                        Aucun enregistrement trouv√©
                    </td>
                </tr>
            </tbody>

        </table>
    </div>
</div>

<!-- ü™ü MODAL : Ajout / modification -->
<div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">

        <h2 class="text-xl font-semibold mb-4 text-gray-700">
            Ajouter un motif ou une justification
        </h2>

        <form (ngSubmit)="saveModal(form)" #form="ngForm" novalidate class="space-y-3">

            <!-- Champs readonly -->
            <input class="input" name="code" [(ngModel)]="modalData.codeSecret" readonly />
            <input class="input" name="nom" [(ngModel)]="modalData.nom" readonly />
            <input class="input" name="prenom" [(ngModel)]="modalData.prenom" readonly />
            <input class="input" name="numero" [(ngModel)]="modalData.numero" readonly />
            <input class="input" name="dateAbsence" [(ngModel)]="modalData.dateAbsence" readonly />

            <!-- Champs modifiables -->
            <div>
                <input class="input" name="motif" [(ngModel)]="modalData.motif" placeholder="Motif" required />
                <p *ngIf="form.submitted && !form.controls['motif']?.valid" class="text-red-500 text-sm">Motif requis
                </p>
            </div>

            <div>
                <input class="input" name="justification" [(ngModel)]="modalData.justification"
                    placeholder="Justification" required />
                <p *ngIf="form.submitted && !form.controls['justification']?.valid" class="text-red-500 text-sm">
                    Justification requise</p>
            </div>

            <input class="input" name="site" [(ngModel)]="modalData.site" readonly />

            <!-- Boutons -->
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" (click)="closeModal()" class="px-4 py-2 bg-gray-400 text-white rounded-lg">
                    Annuler
                </button>
                <button type="submit" [disabled]="form.invalid"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                    Mettre √† jour
                </button>
            </div>

        </form>
    </div>
</div>