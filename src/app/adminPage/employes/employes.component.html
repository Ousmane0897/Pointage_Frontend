<div class="max-w-7xl mx-auto p-4 space-y-6">

    <!-- üîç Recherche -->
    <div class="relative w-full max-w-md">
        <input type="text" [(ngModel)]="searchText" placeholder="Recherche..." class="w-full pl-10 pr-4 py-2 border rounded-lg shadow-sm
             focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
            fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
    </div>

    <!-- üéØ Actions -->
    <div class="flex flex-wrap gap-3">
        <button (click)="exportExcel()" class="bg-green-600 text-white px-4 py-2 rounded">
            Excel
        </button>
        <button (click)="exportPdf()" class="bg-red-600 text-white px-4 py-2 rounded">
            PDF
        </button>
        <button (click)="openAddModal()" class="bg-blue-600 text-white px-4 py-2 rounded">
            ‚ûï Ajouter
        </button>
    </div>

    <!-- üìã TABLE -->
    <div class="overflow-x-auto border rounded-xl shadow">
        <table class="min-w-[1200px] w-full text-sm border-collapse">
            <thead class="bg-gray-100 uppercase text-xs">
                <tr>
                    <th class="p-3">Code</th>
                    <th class="p-3">Pr√©nom</th>
                    <th class="p-3">Nom</th>
                    <th class="p-3">Num√©ro</th>
                    <th class="p-3">Intervention</th>
                    <th class="p-3">Statut</th>
                    <th class="p-3">Site(s)</th>
                    <th class="p-3">Horaires</th>
                    <th class="p-3 text-center">Actions</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let employe of filteredEmployes" class="border-t hover:bg-gray-50">

                    <td class="p-3 font-medium">{{ employe.codeSecret }}</td>
                    <td class="p-3">{{ employe.prenom }}</td>
                    <td class="p-3">{{ employe.nom }}</td>
                    <td class="p-3">{{ employe.numero }}</td>
                    <td class="p-3">{{ employe.intervention }}</td>

                    <!-- ‚úÖ Statut badge -->
                    <td class="p-3">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold" [ngClass]="{
                'bg-green-100 text-green-800': employe.statut === 'ACTIF',
                'bg-yellow-100 text-yellow-800': employe.statut === 'Pause',
                'bg-red-100 text-red-800': employe.statut === 'Sortie'
              }">
                            {{ employe.statut }}
                        </span>
                    </td>

                    <!-- Sites -->
                    <td class="p-3 space-y-1">
                        <span *ngFor="let site of employe.site"
                            class="block bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs text-center">
                            {{ site }}
                        </span>
                    </td>

                    <!-- Horaires -->
                    <td class="p-3">
                        <div class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs text-center">
                            {{ employe.heureDebut }} - {{ employe.heureFin }}
                            <div *ngIf="employe.heureDebut2 && employe.heureFin2">
                                {{ employe.heureDebut2 }} - {{ employe.heureFin2 }}
                            </div>
                        </div>
                    </td>

                    <!-- Actions -->
                    <td class="p-3 flex justify-center gap-2">
                        <button (click)="openEditModal(employe)"
                            class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full">
                            ‚úèÔ∏è
                        </button>
                        <button (click)="deleteRow(employe.codeSecret)"
                            class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full">
                            üóë
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ü™ü MODAL -->
<div *ngIf="showModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">

    <div class="bg-white w-full max-w-lg p-6 rounded-xl shadow max-h-[90vh] overflow-y-auto">
        <h2 class="text-xl font-semibold mb-4">
            {{ isEditMode ? 'Modifier' : 'Ajouter' }} un employ√©
        </h2>

        <form (ngSubmit)="saveModal(form)" #form="ngForm" class="space-y-3">

            <input class="w-full p-2 border rounded" name="code" [(ngModel)]="modalData.codeSecret"
                placeholder="Code employ√©" required />

            <input class="w-full p-2 border rounded" name="prenom" [(ngModel)]="modalData.prenom" placeholder="Pr√©nom"
                required />

            <input class="w-full p-2 border rounded" name="nom" [(ngModel)]="modalData.nom" placeholder="Nom"
                required />

            <input class="w-full p-2 border rounded" name="numero" [(ngModel)]="modalData.numero"
                placeholder="Num√©ro (9 chiffres)" required pattern="^\d{9}$" />

            <input class="w-full p-2 border rounded" name="intervention" [(ngModel)]="modalData.intervention"
                placeholder="Intervention" required />

            <!-- Statut -->
            <select class="w-full p-2 border rounded" name="statut" [(ngModel)]="modalData.statut" required>
                <option value="">S√©lectionner un statut</option>
                <option *ngFor="let statut of statuts" [value]="statut">
                    {{ statut }}
                </option>
            </select>

            <!-- Horaires -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <mat-form-field appearance="outline">
                    <mat-label>Heure d√©but</mat-label>
                    <input matInput [ngxMatTimepicker]="startPicker" [(ngModel)]="modalData.heureDebut"
                        name="heureDebut" readonly />
                    <ngx-mat-timepicker #startPicker></ngx-mat-timepicker>
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Heure fin</mat-label>
                    <input matInput [ngxMatTimepicker]="endPicker" [(ngModel)]="modalData.heureFin" name="heureFin"
                        readonly />
                    <ngx-mat-timepicker #endPicker></ngx-mat-timepicker>
                </mat-form-field>
            </div>

            <!-- Boutons -->
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" (click)="closeModal()" class="px-4 py-2 bg-gray-400 text-white rounded">
                    Annuler
                </button>
                <button type="submit" [disabled]="form.invalid" class="px-4 py-2 bg-blue-600 text-white rounded">
                    {{ isEditMode ? 'Mettre √† jour' : 'Ajouter' }}
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ‚úÖ Toast -->
<div *ngIf="toastMessage" class="fixed bottom-5 right-5 bg-green-600 text-white px-4 py-2 rounded shadow z-50">
    {{ toastMessage }}
</div>