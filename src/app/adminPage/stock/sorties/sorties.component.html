<!-- ===================== -->
<!-- ðŸ”” ALERTE STOCK CRITIQUE -->
<!-- ===================== -->
<div *ngIf="alertesStock.length > 0" class="fixed top-6 left-1/2 -translate-x-1/2 z-50
            bg-red-100 border border-red-300 text-red-800
            rounded-xl shadow-xl
            p-5 w-2/3 max-w-4xl">

  <h3 class="font-semibold text-xl mb-3 text-center">
    âš ï¸ Stock critique :
    {{ alertesStock.length }} produit{{ alertesStock.length > 1 ? 's' : '' }}
  </h3>

  <ul class="grid grid-cols-2 gap-2 text-base">
    <li *ngFor="let a of alertesStock">
      ðŸ§´ <strong>{{ a.nomProduit }}</strong> â€”
      <span class="text-red-700">{{ a.stock }}</span>
      /
      <span class="text-gray-700">{{ a.seuil }}</span>
    </li>
  </ul>
</div>

<!-- ===================== -->
<!-- ðŸ“¦ CONTENEUR PRINCIPAL -->
<!-- ===================== -->
<div class="p-8 bg-white rounded-2xl shadow-lg max-w-7xl mx-auto mt-6">

  <!-- ===================== -->
  <!-- ðŸ§­ EN-TÃŠTE -->
  <!-- ===================== -->
  <div class="flex items-center gap-4 mb-8">
    <svg class="w-12 h-12 text-gray-800" viewBox="0 -960 960 960" fill="currentColor">
      <path d="M270-160q-50 0-82-36t-27-85H61l13-60h112q15-18
           36.5-28.5T270-380q26 0 47.5 10.5T354-341h198
           l92-399H186l3-13q5-21 21-34t37-13h472l-39
           170h125l114 152-39 197h-80q5 49-27.5 85T690-160
           q-50 0-82-36t-27-85H380q5 49-27.5 85T270-160Z" />
    </svg>

    <h2 class="text-3xl font-semibold text-gray-800">
      Sortie de produits
    </h2>
  </div>

  <!-- ===================== -->
  <!-- ðŸ§¾ FORMULAIRE -->
  <!-- ===================== -->
  <form [formGroup]="sortieForm" class="space-y-8">

    <!-- ===================== -->
    <!-- ðŸ“‹ DONNÃ‰ES ANNEXES -->
    <!-- ===================== -->
    <div class="grid grid-cols-3 gap-6 bg-gray-50 p-5 rounded-xl">

      <!-- MOTIF -->
      <div>
        <label class="block text-sm font-medium mb-1">Motif</label>
        <select formControlName="motifSortieStock" class="w-full border rounded-lg p-3"
          (change)="onMotifChange($event)">
          <option value="">-- Choisir un motif --</option>
          <option *ngFor="let option of motifs" [value]="option">
            {{ option }}
          </option>
        </select>

        <p class="mt-2 text-sm text-gray-600">
          Motif sÃ©lectionnÃ© :
          <strong>{{ sortieForm.get('motifSortieStock')?.value || 'â€”' }}</strong>
        </p>
      </div>

      <!-- AGENCE -->
      <div>
        <label class="block text-sm font-medium mb-1">Agence</label>
        <select formControlName="destination" class="w-full border rounded-lg p-3">
          <option value="">-- Choisir une agence --</option>
          <option *ngFor="let agence of agences" [value]="agence">
            {{ agence }}
          </option>
        </select>
      </div>

      <!-- RESPONSABLE -->
      <div>
        <label class="block text-sm font-medium mb-1">Responsable</label>
        <input type="text" formControlName="responsable" placeholder="Nom du responsable"
          class="w-full border rounded-lg p-3" />
      </div>
    </div>

    <!-- ===================== -->
    <!-- ðŸ“¦ PRODUITS Ã€ SORTIR -->
    <!-- ===================== -->
    <div>
      <h3 class="text-xl font-medium mb-4">Produits Ã  sortir</h3>

      <div formArrayName="produitsFormArray" class="space-y-4">

        <div *ngFor="let produitGroup of produitsFormArray.controls; let i = index" [formGroupName]="i"
          class="grid grid-cols-4 gap-4 bg-gray-50 p-4 rounded-xl items-end">

          <div>
            <label class="block text-sm mb-1">Produit</label>
            <select formControlName="nomProduit" class="w-full border rounded-lg p-2">
              <option value="">-- Choisir --</option>
              <option *ngFor="let prod of produits" [value]="prod.nomProduit">
                {{ prod.nomProduit }}
              </option>
            </select>
          </div>

          <div>
            <label class="block text-sm mb-1">Code</label>
            <input type="text" formControlName="codeProduit" readonly
              class="w-full border rounded-lg p-2 bg-gray-100" />
          </div>

          <div>
            <label class="block text-sm mb-1">QuantitÃ©</label>
            <input type="number" min="1" formControlName="quantite" class="w-full border rounded-lg p-2" />
          </div>

          <button type="button" (click)="supprimerProduit(i)" class="text-red-600 font-medium hover:underline">
            Supprimer
          </button>
        </div>
      </div>

      <button type="button" (click)="ajouterProduit()" class="mt-4 px-5 py-3
                     bg-blue-600 text-white
                     rounded-lg hover:bg-blue-700">
        + Ajouter un produit
      </button>
    </div>

    <!-- ===================== -->
    <!-- ðŸ” APERÃ‡U FINAL -->
    <!-- ===================== -->
    <div *ngIf="apercuProduits.length > 0" class="mt-10">

      <h3 class="text-xl font-semibold mb-4">AperÃ§u final</h3>

      <table class="w-full border text-sm text-left rounded-lg overflow-hidden">
        <thead class="bg-gray-100">
          <tr>
            <th class="p-3 border">Produit</th>
            <th class="p-3 border">Code</th>
            <th class="p-3 border text-center">QuantitÃ©</th>
            <th class="p-3 border">Agence</th>
            <th class="p-3 border">Responsable</th>
            <th class="p-3 border">Motif</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let ap of apercuProduits" class="hover:bg-gray-50">
            <td class="p-3 border">{{ ap.nomProduit }}</td>
            <td class="p-3 border">{{ ap.codeProduit }}</td>
            <td class="p-3 border text-center">{{ ap.quantite }}</td>
            <td class="p-3 border">{{ ap.destination || 'â€”' }}</td>
            <td class="p-3 border">{{ ap.responsable }}</td>
            <td class="p-3 border">{{ ap.motif }}</td>
          </tr>
        </tbody>
      </table>

      <div class="mt-6 text-right">
        <button type="button" (click)="validerSortie()" class="px-8 py-3 bg-green-600
                 text-white text-lg rounded-lg
                 hover:bg-green-700">
          âœ… Valider la sortie
        </button>
      </div>
    </div>

  </form>
</div>