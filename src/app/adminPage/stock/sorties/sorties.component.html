<div class="p-6 bg-white rounded-xl shadow-md">
  <div class="flex space-x-3 mb-6">
    <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#000000">
      <path
        d="M270-160q-50 0-82-36t-27-85H61l13-60h112q15-18 36.5-28.5T270-380q26 0 47.5 10.5T354-341h198l92-399H186l3-13q5-21 21-34t37-13h472l-39 170h125l114 152-39 197h-80q5 49-27.5 85T690-160q-50 0-82-36t-27-85H380q5 49-27.5 85T270-160Zm364-270h215l6-33-80-107H666l-32 140Zm1-273 9-37-92 399 8-36 34-146 41-180ZM22-437l15-60h220l-15 60H22Zm80-146 15-60h260l-15 60H102Zm168 363q21 0 35.5-15t14.5-35q0-21-14.5-35.5T270-320q-20 0-35 14.5T220-270q0 20 15 35t35 15Zm420 0q21 0 35.5-15t14.5-35q0-21-14.5-35.5T690-320q-20 0-35 14.5T640-270q0 20 15 35t35 15Z" />
    </svg>
    <h2 class="text-2xl font-semibold mb-4">Sortie de produits</h2>

    <form [formGroup]="sortieForm" class="space-y-4">
      <h3 class="text-lg font-medium mb-2">Donn√©es annexes</h3>
      <!-- Champs globaux -->   
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-3 rounded-lg">
        <div>
          <select formControlName="destination"
            class="w-full border rounded-lg p-2">
            <option value="">-- Choisir une agence --</option>
            <option *ngFor="let agence of agences" [value]="agence">{{ agence }}</option>
          </select>
        </div>

        <div>
          <input type="text" formControlName="responsable" class="w-full border rounded-lg p-2"
            placeholder="Nom du responsable" />
        </div>

        <div>
          <select formControlName="motifSortieStock" class="w-full border rounded-lg p-2">
            <option value="">-- Choisir un motif --</option>
            <option *ngFor="let motif of motifs" [value]="motif">{{ motif }}</option>
          </select>
        </div>
      </div>

      <!-- Liste des produits -->
      <div class="mt-6">
        <h3 class="text-lg font-medium mb-2">Produit(s) √† sortir</h3>

        <div formArrayName="produitsFormArray" class="space-y-3">
          <div *ngFor="let produitGroup of produitsFormArray.controls; let i = index" [formGroupName]="i"
            class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end bg-gray-50 p-3 rounded-lg">
            <div>
              <label class="block text-sm text-gray-700 mb-1">Produit</label>
              <select formControlName="nomProduit" class="w-full border rounded-lg p-2">
                <option value="">-- Choisir un produit --</option>
                <option *ngFor="let prod of produits" [value]="prod.nomProduit">
                  {{ prod.nomProduit }}
                </option>
              </select>
            </div>

            <div>
              <label class="block text-sm text-gray-700 mb-1">Code Produit</label>
              <input type="text" formControlName="codeProduit" class="w-full border rounded-lg p-2" readonly />
            </div>

            <div>
              <label class="block text-sm text-gray-700 mb-1">Quantit√©</label>
              <input type="number" formControlName="quantite" class="w-full border rounded-lg p-2" min="1" />
            </div>

            <div class="flex items-center">
              <button type="button" (click)="supprimerProduit(i)"
                class="text-red-600 hover:text-red-800 text-sm font-medium">
                Supprimer
              </button>
            </div>
          </div>
        </div>
    
      

        <button type="button" (click)="ajouterProduit()"
          class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          + Ajouter un produit
        </button>
      </div>

      <!-- Aper√ßu final -->
      <div class="mt-6">
        <button type="button" (click)="genererApercu()"
          class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900">
          üîç Aper√ßu avant validation
        </button>
      </div>

      <div *ngIf="apercuProduits.length > 0" class="mt-6 border-t pt-4">
        <h3 class="text-lg font-semibold mb-2">Aper√ßu final</h3>

        <table class="w-full border text-sm text-left">
          <thead class="bg-gray-100">
            <tr>
              <th class="p-2 border">Produit</th>
              <th class="p-2 border">Code</th>
              <th class="p-2 border">Quantit√©</th>
              <th class="p-2 border">Agence</th>
              <th class="p-2 border">Responsable</th>
              <th class="p-2 border">Motif</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ap of apercuProduits" class="hover:bg-gray-50">
              <td class="p-2 border">{{ ap.nomProduit }}</td>
              <td class="p-2 border">{{ ap.codeProduit }}</td>
              <td class="p-2 border">{{ ap.quantite }}</td>
              <td class="p-2 border">{{ ap.destination ? ap.destination : 'Null' }}</td>
              <td class="p-2 border">{{ ap.responsable }}</td>
              <td class="p-2 border">{{ ap.motif }}</td>
            </tr>
          </tbody>
        </table>

        <div class="mt-4 text-right">
          <button type="button" (click)="validerSortie()"
            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
            ‚úÖ Valider la sortie
          </button>
        </div>
      </div>
    </form>
  </div>